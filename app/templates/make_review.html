{% extends "base.html" %}
{% block content %}

<form action="" method="post">
    <div class="container">
        {{ form.hidden_tag() }}
        {{ form.csrf_token }}
        {% if review_type in ["request"] %}
            {% set filling_fields = [form.reviewee, form.reviewer, form.epa, form.location, form.implement_date]%}
            {% set card_subtitle = "請求評核指定的EPA項目" %}
            {% set card_desc = "請填寫以下欄位，評核者只能是所屬醫院或外派醫院中的總醫師/主治醫師" %}
        {% elif review_type in ["new", "fill"] %}
            {% set filling_fields = [form.reviewer, form.reviewee, form.epa, form.location, form.implement_date, form.review_difficulty, form.review_compliment, form.review_suggestion, form.review_score] %} 
            {% if review_tpye == "new"%}
                {% set card_subtitle = "評核住院醫師實作的EPA項目" %}
                {% set card_desc = "請填寫指定被評醫師、項目以及您的評核內容，被評核者只能是所屬醫院(含外派至本院)的住院醫師/總醫師" %} 
            {% elif review_type == "fill" %}
                {% set card_subtitle = "評核住院醫師實作的EPA項目" %}
                {% set card_desc = review.reviewee.username + "請求您評核他實作的" + review.epa.desc +
                     "。此項紀錄於"+review.create_time.strftime("%Y-%m-%d %H時")+"創立，"+("評核完成時間為"+review.last_edited.strftime("%Y-%m-%d %H時") if review.complete else "尚未完成評核") %} 
            {% endif %}
            
        {% elif review_type in ["inspect"] %}
            {% set filling_fields = [form.review_source, form.reviewer, form.reviewee, form.epa, form.location, form.implement_date, form.review_difficulty, form.review_compliment, form.review_suggestion, form.review_score] %}
            {% if review.review_source.name == "request" %}
                {% set card_subtitle = review.reviewee.username + "請求" + review.reviewer.username + "評核" %}
            {% elif review.review_source.name == "new" %}
                {% set card_subtitle = review.reviewer.username + "主動評核" +review.reviewee.username %}
            {% endif %}
            {% set card_desc = "此項紀錄於"+review.create_time.strftime("%Y-%m-%d %H時")+"創立，"+("評核完成時間為"+review.last_edited.strftime("%Y-%m-%d %H時") if review.complete else "尚未完成評核") %}
            
        {% endif %}
        <div class='row'>
            <div class="col-md-3"></div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{title}}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{card_subtitle}}</h6>
                        <p class="card-text">{{card_desc}}</p>
                    </div>
                </div>
            </div>

            <p></p>
            <div class="w-100"></div>


            <div class="text-center col-md-3"></div>
            <div class="text-center col-md-6">
                
                {% for field in filling_fields %}
                    <div class="form-floating">
                        {% if field.type == "SelectField" %}
                            {{ field(class="form-select") }}
                        {% elif field.type == "TextAreaField"%}
                            {{ field(class="form-control", style="height: 100px") }}
                        {% else %}
                            {{ field(class="form-control") }}
                        {% endif %}
                        {{ field.label }}
                        {% for error in field.errors %}
                            <div class="invalid-feedback"><span style="color: red;">[{{ error }}]</span></div>
                        {% endfor %}
                    </div>
                {% endfor %}
                <p></p>
                
                
            </div>
            
            <p></p>
            <div class="w-100"></div>
            <div class="col-md-3"></div>
            <div class="col-md-6">
                {% if review_type != "inspect" %}
                    {{ form.submit(title=form.submit.description, class="w-100 btn btn-outline-primary")}}
                {% else %}
                    <a href="{{url_for('view_reviews')}}" class="w-100 btn btn-outline-primary">回上一頁</a>
                {% endif %}
            </div>
            
    </div>

</form>

{% endblock %}